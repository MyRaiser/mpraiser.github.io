<!DOCTYPE html>
    <html>
    <head>
        <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
        <title>STM32学习笔记</title>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
        
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        
        
    </head>
    <body>
        <style>
    img::after {content: attr(alt);}
</style>
<h1 id="stm32学习笔记">STM32学习笔记</h1>
<p>所用板型：NUCLEO-F103RB</p>
<p>MCU：STM32F103RB</p>
<ul>
<li><a href="#stm32%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0">STM32学习笔记</a>
<ul>
<li><a href="#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86">背景知识</a>
<ul>
<li><a href="#%E9%80%9A%E8%BF%87ide%E5%BC%80%E5%8F%91%E4%B8%8E%E6%89%8B%E5%86%99make%E5%BC%80%E5%8F%91">通过IDE开发与手写make开发</a>
<ul>
<li><a href="#%E9%80%9A%E8%BF%87ide%E5%BC%80%E5%8F%91">通过IDE开发</a>
<ul>
<li><a href="#%E5%85%B3%E4%BA%8Ekeil%CE%BCvisionmdkkeil-c51%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB">关于Keil、μVision、MDK、Keil C51之间的关系</a></li>
</ul>
</li>
<li><a href="#%E6%89%8B%E5%8A%A8make%E5%BC%80%E5%8F%91%E9%80%82%E5%90%88%E9%AB%98%E7%BA%A7%E4%BD%BF%E7%94%A8%E8%80%85">手动make开发（适合高级使用者）</a></li>
</ul>
</li>
<li><a href="#%E5%9F%BA%E4%BA%8E%E5%AF%84%E5%AD%98%E5%99%A8%E5%BC%80%E5%8F%91%E4%B8%8E%E5%9F%BA%E4%BA%8E%E5%BA%93%E5%BC%80%E5%8F%91">基于寄存器开发与基于库开发</a>
<ul>
<li><a href="#%E5%9F%BA%E4%BA%8E%E5%AF%84%E5%AD%98%E5%99%A8%E5%BC%80%E5%8F%91">基于寄存器开发</a></li>
<li><a href="#%E5%9F%BA%E4%BA%8E%E5%BA%93%E5%BC%80%E5%8F%91">基于库开发</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#step-by-step-guidance">Step-by-step Guidance</a>
<ul>
<li><a href="#%E9%85%8D%E7%BD%AE%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83">配置开发环境</a></li>
<li><a href="#%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAblink">实现一个&quot;<code>Blink</code>&quot;</a>
<ul>
<li><a href="#%E4%B8%80-%E4%BD%BF%E7%94%A8stm32cubemx%E7%94%9F%E6%88%90%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%A0%81">一. 使用STM32CubeMX生成基础配置代码</a></li>
<li><a href="#%E4%BA%8C-%E4%BD%BF%E7%94%A8keil%E7%BC%96%E5%86%99%E7%A8%8B%E5%BA%8F">二. 使用Keil编写程序</a></li>
<li><a href="#3-%E7%BC%96%E8%AF%91%E4%B8%8B%E8%BD%BD">3. 编译、下载</a></li>
<li><a href="#4-debug">4. Debug</a></li>
</ul>
</li>
<li><a href="#%E4%B8%AD%E6%96%AD">中断</a></li>
</ul>
</li>
<li><a href="#arduino-stm32">Arduino-STM32</a></li>
<li><a href="#%E9%80%9A%E8%BF%87mbedos%E7%BD%91%E7%AB%99%E6%8F%90%E4%BE%9B%E7%9A%84%E6%96%B9%E5%BC%8F">通过MbedOS网站提供的方式</a></li>
<li><a href="#reference">Reference</a></li>
</ul>
</li>
</ul>
<h2 id="背景知识">背景知识</h2>
<p>这里是一些有的没的背景知识，归纳在这一部分。如果你很急，可以直接跳到<a href="#step-by-step-guidance">step-by-step-guidance</a>。</p>
<h3 id="通过ide开发与手写make开发">通过IDE开发与手写make开发</h3>
<h4 id="通过ide开发">通过IDE开发</h4>
<p>通常来说，STM32使用IDE进行开发的较多，使用IDE也较容易上手。</p>
<p>STM32支持若干种不同的IDE进行开发，<a href="https://www.stmcu.com.cn/Designresource/design_resource_detail?file_name=UM1727_STM32%E7%9A%84Nucleo%E6%9D%BF%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97&amp;lang=EN&amp;ver=5&amp;cat=user_manual">官方文档</a>给出的支持有：</p>
<blockquote>
<ul>
<li>
<p><strong>EWARM v7.10.3 or later(a)</strong></p>
<p>30-day evaluation edition</p>
<p>32-Kbyte Limited QuickStart edition (16-Kbyte limitation for Cortex M0)</p>
</li>
<li>
<p><strong>MDK-ARM v5.17 or later(a)(b)</strong></p>
<p>MDK-Lite (32-Kbyte code size limitation)</p>
</li>
<li>
<p><strong>TrueSTUDIO Lite v5 or later(b)</strong></p>
<p>No limitation</p>
</li>
<li>
<p><strong>SW4STM32 v1.5 and later(a)</strong></p>
<p>No limitation</p>
</li>
</ul>
</blockquote>
<p>EWARM指的是通常意义上的IAR，IAR Embedded Workbench for ARM。</p>
<p>其中MDK-ARM指的是通常意义上的Keil，即Keil MDK-ARM。</p>
<p>本文使用==MDK527==。</p>
<h5 id="关于keilμvisionmdkkeil-c51之间的关系">关于Keil、μVision、MDK、Keil C51之间的关系</h5>
<blockquote>
<ul>
<li><strong>Keil</strong>是公司的名称，<strong>有时候也指Keil公司的所有软件开发工具</strong>，目前2005年Keil由ARM公司收购，成为ARM的公司之一。</li>
<li><strong>μVision</strong>是Keil公司开发的一个集成开发环境（IDE），和Eclipse类似。它包括工程管理，源代码编辑，编译设置，下载调试和模拟仿真等功能，μVision有μVision2、μVision3、μVision4、μVision5四个版本，目前最新的版本是μVision5。它提供一个环境，让开发者易于操作，并不提供能具体的编译和下载功能，需要软件开发者添加。μVision通用于Keil的开发工具中，例如MDK，PK51，PK166，DK251等。</li>
<li><strong>MDK（Microcontroller Development Kit）</strong>，也称<strong>MDK-ARM</strong>、<strong>Keil MDK</strong>、<strong>RealView MDK</strong>、<strong>Keil For ARM</strong>，都是同一个东西。ARM公司现在统一使用MDK-ARM的称呼，MDK的设备数据库中有很多厂商的芯片，是专为微控制器开发的工具，为满足基于MCU进行嵌入式软件开发的工程师需求而设计，支持ARM7，ARM9，Cortex-M4/M3/M1，Cortex-R0/R3/R4等ARM微控制器内核</li>
</ul>
</blockquote>
<blockquote>
<p><img src="file:///e:\USTC\mpraiser.github.io\markdown-notes\STM32-learning-notes\MDK5.png" alt="">
从上图可以看出，MDK Core 又分成四个部分：μVision IDE with Editor（编辑器），ARM
C/C++ Compiler（编译器），Pack Installer（包安装器），μVision Debugger with Trace（调试跟踪
器）。</p>
</blockquote>
<h4 id="手动make开发适合高级使用者">手动make开发（适合高级使用者）</h4>
<p>笔者目前也不会，先提供一个<a href="http://www.stmcu.org.cn/module/forum/thread-603753-1-1.html">链接</a>以供参考。</p>
<h3 id="基于寄存器开发与基于库开发">基于寄存器开发与基于库开发</h3>
<h4 id="基于寄存器开发">基于寄存器开发</h4>
<p>在传统C51中通常对寄存器进行直接操作来实现功能，如设置端口电平为：</p>
<p>对STM32来说，当然也可以这么做。但是STM32的上百个寄存器，相比于51的二十几个，要一个个记住、单独操作不大现实，过于麻烦。所以通常来说，STM32的开发都是使用HAL库进行开发的。</p>
<h4 id="基于库开发">基于库开发</h4>
<ol>
<li>传统的Keil ARM开发模式
标准库</li>
<li>通过STM的HAL以及CubeMx配置的模式</li>
</ol>
<h2 id="step-by-step-guidance">Step-by-step Guidance</h2>
<p>在这篇笔记中，使用的是CubeMx + Keil MDK-ARM，使用HAL库进行开发的开发方式。</p>
<h3 id="配置开发环境">配置开发环境</h3>
<ol>
<li>
<p><a href="https://www.Keil.com/download/product/">MDK5（Keil µvision5）</a>，官方网站下载，本文使用的版本是==MDK527==。（当然可能还要破解一下）（当然也可以去各种X盘下载）</p>
</li>
<li>
<p><a href="https://www.stmcu.com.cn/Designresource/design_resource_detail/file/315621/lang/EN/token/959ecda9e5c252b9b101db286ab1736f">ST-Link驱动</a>，在ST官网下载。</p>
<blockquote>
<p>All the STM32 Nucleo boards include an ST-LINK/V2-1 embedded debug tool interface.This interface needs a dedicated USB driver to be installed.</p>
</blockquote>
</li>
<li>
<p>MDK5相关于这几个处理器的固件包（Firmware Package），Keil官网下载/或者在Keil中使用<em>Pack Installer</em>。</p>
</li>
<li>
<p><a href="https://www.st.com/zh/development-tools/stm32cubemx.html">STM32CubeMx</a>，官方网站下载。</p>
</li>
</ol>
<h3 id="实现一个blink">实现一个&quot;<code>Blink</code>&quot;</h3>
<p><code>Blink</code>相当于单片机编程中的<code>Helloworld</code>，它的目标就是让一个LED（通常是板载的LED）Blink一下。
下面展示使用CubeMX搭建工程，并在Keil中编译下载的方法：</p>
<h4 id="一-使用stm32cubemx生成基础配置代码">一. 使用STM32CubeMX生成基础配置代码</h4>
<ol>
<li>
<p>打开CubeMx，在New Project区进入板型选择器。
<img src="file:///e:\USTC\mpraiser.github.io\markdown-notes\STM32-learning-notes\CubeMX-main-interface.png" alt="CubeMx主界面"></p>
</li>
<li>
<p>搜索相应的板子型号，双击搜索结果。
<img src="file:///e:\USTC\mpraiser.github.io\markdown-notes\STM32-learning-notes\CubeMX-board-selector.png" alt="CubeMx版型选择器"></p>
</li>
<li>
<p>默认，选Yes。
<img src="file:///e:\USTC\mpraiser.github.io\markdown-notes\STM32-learning-notes\CubeMX-initialize-default-mode.png" alt="默认Yes"></p>
</li>
<li>
<p>点击每个引脚可以直接配置其输出方式。在这里由于我们没有需求，所以不用改动。
<img src="file:///e:\USTC\mpraiser.github.io\markdown-notes\STM32-learning-notes\CubeMX-pinout.png" alt="Pinout"></p>
</li>
<li>
<p>进入Project Manager。
<img src="file:///e:\USTC\mpraiser.github.io\markdown-notes\STM32-learning-notes\CubeMX-choose-project-manager.png" alt="选择Project Manager"></p>
</li>
<li>
<p>设置工程的名字和路径。别忘了将IDE选择为==MDK-ARM V5==。
<img src="file:///e:\USTC\mpraiser.github.io\markdown-notes\STM32-learning-notes\CubeMX-project-manager.png" alt="设置Project Manager"></p>
</li>
<li>
<p>点击GENERATE CODE，生成工程！
<img src="file:///e:\USTC\mpraiser.github.io\markdown-notes\STM32-learning-notes\CubeMX-generate-code.png" alt="生成工程"></p>
</li>
<li>
<p>这个时候工程已经生成好了，接下来点击Open Project，将工作转移到Keil。
<img src="file:///e:\USTC\mpraiser.github.io\markdown-notes\STM32-learning-notes\CubeMX-open-project.png" alt="打开工程"></p>
</li>
</ol>
<h4 id="二-使用keil编写程序">二. 使用Keil编写程序</h4>
<ol>
<li>
<p>打开Keil主界面，这时候CubeMX已经帮我们配置好了一堆库文件，我们不用管他们。接下来我们只需做自己的事就行了。比如找到<code>main.c</code>：
<img src="file:///e:\USTC\mpraiser.github.io\markdown-notes\STM32-learning-notes\Keil-interface.png" alt="Keil主界面"></p>
</li>
<li>
<p>可以看到<code>main.c</code>里这时候已经被CubeMx生成了一堆初始化代码，同样不用管：
<img src="file:///e:\USTC\mpraiser.github.io\markdown-notes\STM32-learning-notes\Keil-main-initialization.png" alt="main.c"></p>
</li>
</ol>
<p>找到<code>main()</code>函数：
<img src="file:///e:\USTC\mpraiser.github.io\markdown-notes\STM32-learning-notes\Keil-main.png" alt="main()"></p>
<ol start="3">
<li>在<code>main()</code>函数里一堆初始化函数后的循环里加入<code>Blink</code>的功能代码：</li>
</ol>
<pre><code class="language-C"><div>HAL_GPIO_WritePin(GPIOA,GPIO_PIN_5,GPIO_PIN_SET);
HAL_Delay(<span class="hljs-number">100</span>);
HAL_GPIO_WritePin(GPIOA,GPIO_PIN_5, GPIO_PIN_RESET);
HAL_Delay(<span class="hljs-number">100</span>);
</div></code></pre>
<p>这段代码对板载LED所在IO口每隔100毫秒进行写一次高/低电平，这里调用的全部都是HAL库的函数。</p>
<h4 id="3-编译下载">3. 编译、下载</h4>
<p>先执行Build将代码编译，如果代码有Error或者Warning，会在下方的Build Output窗口产生报错信息。如果没有问题，那么将板子通过USB连接到电脑，可以进行Download了。这一步将代码烧到STM32板子的flash内。
<img src="file:///e:\USTC\mpraiser.github.io\markdown-notes\STM32-learning-notes\Keil-build&amp;download.png" alt="编译下载"></p>
<p>提示烧写完毕：
<img src="file:///e:\USTC\mpraiser.github.io\markdown-notes\STM32-learning-notes\Keil-download-information.png" alt="下载信息"></p>
<p>这个时候再按一下板子的Reset按钮，就可以看到板载的LED闪起来了。</p>
<h4 id="4-debug">4. Debug</h4>
<p>当然也可以进行（也是非常必要）的一步是debug。选择Debug菜单-Start/Stop Debug Session进入debug模式：
<img src="file:///e:\USTC\mpraiser.github.io\markdown-notes\STM32-learning-notes\Keil-debug.png" alt="Debug"></p>
<p>在这里可以像debug本机程序一样设置断点，单步执行等。在右下角Call Stack里可以监视程序的变量。
<img src="file:///e:\USTC\mpraiser.github.io\markdown-notes\STM32-learning-notes\Keil-debug-interface.png" alt="Debug界面"></p>
<h3 id="中断">中断</h3>
<h2 id="arduino-stm32">Arduino-STM32</h2>
<p>目前还没试验成功。</p>
<ol>
<li>安装Arduino IDE[^]</li>
<li>工具-开发板管理器-安装Arduino SAM boards (Cortex-M3)
<blockquote>
<p>You must do this step, it installs the arm-none-eabi-g++ toolchain）</p>
</blockquote>
</li>
</ol>
<h2 id="通过mbedos网站提供的方式">通过MbedOS网站提供的方式</h2>
<h2 id="reference">Reference</h2>
<ol>
<li><a href="https://www.jianshu.com/p/e1b6503f638b">https://www.jianshu.com/p/e1b6503f638b</a></li>
<li><a href="https://www.stmcu.com.cn/Designresource/design_resource_detail?file_name=UM1724_STM32%E7%9A%8464%E5%BC%95%E8%84%9ANucleo%E6%9D%BF%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C&amp;lang=EN&amp;ver=9&amp;cat=user_manual">STM32的Nucleo版用户手册</a></li>
</ol>

    </body>
    </html>